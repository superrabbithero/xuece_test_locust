# å¯åŠ¨æ€§èƒ½åˆ†ææŠ¥å‘Š

## é—®é¢˜æè¿°

å¯åŠ¨ 1000 ä¸ªç”¨æˆ·ç”¨äº† 10 åˆ†é’Ÿï¼Œå¯åŠ¨é€Ÿåº¦è¿‡æ…¢ã€‚

## æ€§èƒ½ç“¶é¢ˆåˆ†æ

### 1. åŒæ­¥ç™»å½•é˜»å¡ï¼ˆä¸»è¦é—®é¢˜ï¼‰âš ï¸

**é—®é¢˜ä½ç½®**ï¼š`src/users/ecommerce_user.py` çš„ `on_start()` æ–¹æ³•

**é—®é¢˜æè¿°**ï¼š
- å½“ `LOGIN_MODE=on_start` æ—¶ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½ä¼šåœ¨ `on_start()` ä¸­æ‰§è¡ŒåŒæ­¥çš„ `_login()`
- `_login()` æ˜¯**é˜»å¡æ“ä½œ**ï¼Œéœ€è¦ç­‰å¾… HTTP å“åº”
- Locust é»˜è®¤æƒ…å†µä¸‹ï¼Œ`on_start()` æ˜¯**åŒæ­¥æ‰§è¡Œ**çš„ï¼Œæ¯ä¸ªç”¨æˆ·å¿…é¡»ç­‰å¾…ç™»å½•å®Œæˆæ‰èƒ½ç»§ç»­

**æ€§èƒ½å½±å“**ï¼š
- å¦‚æœæ¯ä¸ªç™»å½•è¯·æ±‚éœ€è¦ 0.6 ç§’ï¼Œ1000 ä¸ªç”¨æˆ·éœ€è¦ 600 ç§’ï¼ˆ10 åˆ†é’Ÿï¼‰
- å¦‚æœæœåŠ¡å™¨å“åº”æ…¢æˆ–æœ‰é™æµï¼Œæ—¶é—´ä¼šæ›´é•¿
- å¦‚æœæœåŠ¡å™¨æœ‰å¹¶å‘é™åˆ¶ï¼ˆä¾‹å¦‚æœ€å¤šåŒæ—¶å¤„ç† 100 ä¸ªç™»å½•è¯·æ±‚ï¼‰ï¼Œå‰©ä½™ç”¨æˆ·éœ€è¦æ’é˜Ÿç­‰å¾…

**ä»£ç ä½ç½®**ï¼š
```python
# src/users/ecommerce_user.py:131-132
login_mode = getattr(settings, "LOGIN_MODE", "on_start")
if login_mode == "on_start":
    self._login()  # åŒæ­¥é˜»å¡æ“ä½œ
```

### 2. æ—¥å¿—è®°å½•å¼€é”€ï¼ˆæ¬¡è¦é—®é¢˜ï¼‰

**é—®é¢˜ä½ç½®**ï¼š`src/users/ecommerce_user.py` çš„ `on_start()` æ–¹æ³•

**é—®é¢˜æè¿°**ï¼š
- æ¯ä¸ªç”¨æˆ·éƒ½ä¼šè®°å½•å¤šæ¡æ—¥å¿—ï¼ˆ`logger.info`ï¼‰
- å¦‚æœæ—¥å¿—å†™å…¥æ–‡ä»¶ï¼Œæ–‡ä»¶ I/O å¯èƒ½æˆä¸ºç“¶é¢ˆ
- æ—¥å¿—ç³»ç»Ÿå¯èƒ½æœ‰é”ï¼Œå¯¼è‡´å¹¶å‘å†™å…¥å˜æ…¢

**æ€§èƒ½å½±å“**ï¼š
- æ¯æ¡æ—¥å¿—è®°å½•å¯èƒ½æ¶ˆè€—å‡ æ¯«ç§’
- 1000 ä¸ªç”¨æˆ· Ã— å¤šæ¡æ—¥å¿— = æ•°åƒæ¬¡æ—¥å¿—å†™å…¥
- å¦‚æœæ—¥å¿—æ–‡ä»¶å¾ˆå¤§ï¼Œå†™å…¥ä¼šæ›´æ…¢

**ä»£ç ä½ç½®**ï¼š
```python
# src/users/ecommerce_user.py:125
logger.info(f"ç”¨æˆ· {id(self)} ä½¿ç”¨è´¦å· {self.account.get('username')} ç™»å½•")

# src/users/ecommerce_user.py:112-118
logger.info(
    "è´¦å·ç±»å‹: %s, é€‰ä¸­ä»»åŠ¡æ•°é‡: %d, ä»»åŠ¡åˆ—è¡¨: %s, é…ç½®çš„ SELECTED_TASKS: %s",
    ...
)
```

### 3. CSV æ–‡ä»¶è¯»å–ï¼ˆä¸€æ¬¡æ€§å¼€é”€ï¼‰

**é—®é¢˜ä½ç½®**ï¼š`src/loaders/csv_loader.py` çš„ `__init__()` æ–¹æ³•

**é—®é¢˜æè¿°**ï¼š
- CSV è´¦å·åŠ è½½å™¨åœ¨åˆå§‹åŒ–æ—¶è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜
- å¦‚æœ CSV æ–‡ä»¶å¾ˆå¤§ï¼ˆä¾‹å¦‚ 30000 è¡Œï¼‰ï¼Œè¯»å–å¯èƒ½è¾ƒæ…¢

**æ€§èƒ½å½±å“**ï¼š
- è¿™æ˜¯**ä¸€æ¬¡æ€§å¼€é”€**ï¼Œåªåœ¨ç¬¬ä¸€ä¸ªç”¨æˆ·åˆ›å»ºæ—¶æ‰§è¡Œ
- å¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼ˆ>100MBï¼‰ï¼Œå¯èƒ½éœ€è¦å‡ ç§’åˆ°å‡ åç§’
- ä½†è¿™ä¸æ˜¯ä¸»è¦ç“¶é¢ˆï¼Œå› ä¸ºåªæ‰§è¡Œä¸€æ¬¡

**ä»£ç ä½ç½®**ï¼š
```python
# src/loaders/csv_loader.py:32-34
with open(file_path, 'r', encoding='utf-8', newline='') as csvfile:
    reader = csv.DictReader(csvfile)
    all_rows = list(reader)  # è¯»å–æ‰€æœ‰è¡Œåˆ°å†…å­˜
```

### 4. ä»»åŠ¡é€‰æ‹©é€»è¾‘ï¼ˆå½±å“å¾ˆå°ï¼‰

**é—®é¢˜ä½ç½®**ï¼š`src/utils/task_selector.py` çš„ `select_tasks()` å‡½æ•°

**æ€§èƒ½å½±å“**ï¼š
- ä»»åŠ¡é€‰æ‹©é€»è¾‘æ˜¯çº¯ Python ä»£ç ï¼Œæ‰§è¡Œå¾ˆå¿«ï¼ˆ<1msï¼‰
- å¯¹æ•´ä½“æ€§èƒ½å½±å“å¾ˆå°

## æ€§èƒ½ç“¶é¢ˆä¼˜å…ˆçº§

1. **ğŸ”´ åŒæ­¥ç™»å½•é˜»å¡**ï¼ˆä¸»è¦ç“¶é¢ˆï¼‰- å  90%+ çš„æ—¶é—´
2. **ğŸŸ¡ æ—¥å¿—è®°å½•å¼€é”€**ï¼ˆæ¬¡è¦ç“¶é¢ˆï¼‰- å¯èƒ½å  5-10% çš„æ—¶é—´
3. **ğŸŸ¢ CSV æ–‡ä»¶è¯»å–**ï¼ˆä¸€æ¬¡æ€§å¼€é”€ï¼‰- åªå½±å“å¯åŠ¨å‰å‡ ç§’
4. **ğŸŸ¢ ä»»åŠ¡é€‰æ‹©é€»è¾‘**ï¼ˆå½±å“å¾ˆå°ï¼‰- å¯å¿½ç•¥

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ task æ¨¡å¼ï¼ˆæ¨èï¼‰âœ…

**ä¼˜ç‚¹**ï¼š
- ç™»å½•è¯·æ±‚åˆ†æ•£åˆ°ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸ä¼šåœ¨å¯åŠ¨æ—¶é›†ä¸­é˜»å¡
- ç™»å½•æ¥å£çš„å¹¶å‘åº¦ç”± Locust çš„ç”¨æˆ·æ•°å’Œ spawn_rate æ§åˆ¶
- å¯åŠ¨é€Ÿåº¦ä¼šå¤§å¹…æå‡ï¼ˆä» 10 åˆ†é’Ÿé™åˆ°å‡ ç§’ï¼‰

**é…ç½®**ï¼š
```env
LOGIN_MODE=task
SELECTED_TASKS=student:login_only,student:user_homepage
```

**è¯´æ˜**ï¼š
- ç”¨æˆ·å¯åŠ¨æ—¶ä¸ç™»å½•ï¼Œå¯åŠ¨é€Ÿåº¦å¾ˆå¿«
- ç™»å½•è¯·æ±‚åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶å‘å‡ºï¼Œåˆ†æ•£åˆ°æ•´ä¸ªå‹æµ‹è¿‡ç¨‹ä¸­
- å¦‚æœä¸šåŠ¡ä»»åŠ¡éœ€è¦ç™»å½•ï¼Œå¯ä»¥ä½¿ç”¨ `ensure_logged_in()` è‡ªåŠ¨æ£€æŸ¥

### æ–¹æ¡ˆ 2ï¼šå‡å°‘æ—¥å¿—è®°å½•

**ä¼˜åŒ–**ï¼š
- å°† `logger.info` æ”¹ä¸º `logger.debug`ï¼Œå‡å°‘æ—¥å¿—è¾“å‡º
- æˆ–è€…åªåœ¨ç¬¬ä¸€æ¬¡ç”¨æˆ·åˆ›å»ºæ—¶è®°å½•æ—¥å¿—

**ä»£ç ä¿®æ”¹**ï¼š
```python
# åªåœ¨ç¬¬ä¸€æ¬¡ç”¨æˆ·åˆ›å»ºæ—¶è®°å½•
if not hasattr(EcommerceUser, '_first_user_logged'):
    logger.info(f"ç”¨æˆ· {id(self)} ä½¿ç”¨è´¦å· {self.account.get('username')} ç™»å½•")
    EcommerceUser._first_user_logged = True
else:
    logger.debug(f"ç”¨æˆ· {id(self)} ä½¿ç”¨è´¦å· {self.account.get('username')} ç™»å½•")
```

### æ–¹æ¡ˆ 3ï¼šä¼˜åŒ– CSV æ–‡ä»¶è¯»å–ï¼ˆå¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼‰

**ä¼˜åŒ–**ï¼š
- ä½¿ç”¨ç”Ÿæˆå™¨æˆ–æµå¼è¯»å–ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰è¡Œ
- ä½†è€ƒè™‘åˆ°è¿™æ˜¯**ä¸€æ¬¡æ€§å¼€é”€**ï¼Œä¼˜åŒ–æ”¶ç›Šæœ‰é™

### æ–¹æ¡ˆ 4ï¼šè°ƒæ•´ Locust çš„ spawn_rate

**è¯´æ˜**ï¼š
- å¦‚æœå¿…é¡»ä½¿ç”¨ `on_start` æ¨¡å¼ï¼Œå¯ä»¥è°ƒæ•´ `spawn_rate` æ¥æ§åˆ¶ç”¨æˆ·å¯åŠ¨é€Ÿåº¦
- ä½†è¿™åªæ˜¯**æ§åˆ¶å¯åŠ¨é€Ÿåº¦**ï¼Œä¸èƒ½è§£å†³ç™»å½•é˜»å¡çš„æ ¹æœ¬é—®é¢˜

**ç¤ºä¾‹**ï¼š
```bash
locust -f src/locustfile.py --users 1000 --spawn-rate 10
# spawn-rate 10 è¡¨ç¤ºæ¯ç§’å¯åŠ¨ 10 ä¸ªç”¨æˆ·
# 1000 ä¸ªç”¨æˆ·éœ€è¦ 100 ç§’ï¼ˆ1åˆ†40ç§’ï¼‰æ‰èƒ½å…¨éƒ¨å¯åŠ¨
```

## æ¨èæ–¹æ¡ˆ

**å¼ºçƒˆæ¨èä½¿ç”¨æ–¹æ¡ˆ 1ï¼ˆtask æ¨¡å¼ï¼‰**ï¼š

1. âœ… **å¯åŠ¨é€Ÿåº¦å¿«**ï¼šç”¨æˆ·åˆ›å»ºæ—¶ä¸éœ€è¦ç™»å½•ï¼Œå¯åŠ¨æ—¶é—´ä» 10 åˆ†é’Ÿé™åˆ°å‡ ç§’
2. âœ… **ç™»å½•å‹åŠ›å¯æ§**ï¼šç™»å½•è¯·æ±‚çš„å¹¶å‘åº¦ç”± Locust é…ç½®æ§åˆ¶
3. âœ… **æ›´ç¬¦åˆå‹æµ‹åœºæ™¯**ï¼šç™»å½•æ¥å£ä¹Ÿå¯ä»¥ä½œä¸ºå‹æµ‹å¯¹è±¡
4. âœ… **çµæ´»æ€§é«˜**ï¼šå¯ä»¥æ··åˆå‹æµ‹ç™»å½•å’Œä¸šåŠ¡æ¥å£

**é…ç½®ç¤ºä¾‹**ï¼š
```env
# .env æ–‡ä»¶
LOGIN_MODE=task
SELECTED_TASKS=student:login_only,student:user_homepage
```

**æ‰§è¡Œå‘½ä»¤**ï¼š
```bash
locust -f src/locustfile.py --users 1000 --spawn-rate 100
```

## æ€§èƒ½å¯¹æ¯”

| æ¨¡å¼ | å¯åŠ¨æ—¶é—´ï¼ˆ1000ç”¨æˆ·ï¼‰ | ç™»å½•è¯·æ±‚æ—¶æœº | é€‚ç”¨åœºæ™¯ |
|------|---------------------|-------------|---------|
| `on_start` æ¨¡å¼ | **~10 åˆ†é’Ÿ** | å¯åŠ¨æ—¶é›†ä¸­æ‰§è¡Œ | ä¼ ç»Ÿå‹æµ‹ï¼ˆä¸æ¨èï¼‰ |
| `task` æ¨¡å¼ | **~10 ç§’** | ä»»åŠ¡æ‰§è¡Œæ—¶åˆ†æ•£æ‰§è¡Œ | ç°ä»£å‹æµ‹ï¼ˆæ¨èï¼‰ |

## æ€»ç»“

**ä¸»è¦é—®é¢˜**ï¼šåŒæ­¥ç™»å½•é˜»å¡å¯¼è‡´å¯åŠ¨æ…¢

**æ ¹æœ¬åŸå› **ï¼š`on_start()` ä¸­çš„åŒæ­¥ HTTP è¯·æ±‚é˜»å¡äº†ç”¨æˆ·åˆ›å»ºæµç¨‹

**æœ€ä½³è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `LOGIN_MODE=task`ï¼Œå°†ç™»å½•è¡Œä¸ºæ”¾åˆ°ä»»åŠ¡ä¸­æ‰§è¡Œ

